function eachIterator(a,b,c){setTimeout(function(){a.push(b),c()},25*b)}function mapIterator(a,b,c){setTimeout(function(){a.push(b),c(null,2*b)},25*b)}function filterIterator(a,b){setTimeout(function(){b(a%2)},25*a)}function detectIterator(a,b,c){setTimeout(function(){a.push(b),c(2==b)},25*b)}function eachNoCallbackIterator(a,b,c){a.equal(b,1),c(),a.done()}function getFunctionsObject(a){return{one:function(b){setTimeout(function(){a.push(1),b(null,1)},125)},two:function(b){setTimeout(function(){a.push(2),b(null,2)},200)},three:function(b){setTimeout(function(){a.push(3),b(null,3,3)},50)}}}var async=require("../lib/async");Function.prototype.bind||(Function.prototype.bind=function(a){var b=Array.prototype.slice.call(arguments,1),c=this;return function(){c.apply(a,b.concat(Array.prototype.slice.call(arguments)))}}),exports.forever=function(a){function b(a){return c++,50===c?a("too big!"):void async.setImmediate(function(){a()})}a.expect(1);var c=0;async.forever(b,function(b){a.equal(b,"too big!"),a.done()})},exports.applyEach=function(a){a.expect(4);var b=[],c=function(c,d){a.equal(c,5),setTimeout(function(){b.push("one"),d(null,1)},100)},d=function(c,d){a.equal(c,5),setTimeout(function(){b.push("two"),d(null,2)},50)},e=function(c,d){a.equal(c,5),setTimeout(function(){b.push("three"),d(null,3)},150)};async.applyEach([c,d,e],5,function(){a.same(b,["two","one","three"]),a.done()})},exports.applyEachSeries=function(a){a.expect(4);var b=[],c=function(c,d){a.equal(c,5),setTimeout(function(){b.push("one"),d(null,1)},100)},d=function(c,d){a.equal(c,5),setTimeout(function(){b.push("two"),d(null,2)},50)},e=function(c,d){a.equal(c,5),setTimeout(function(){b.push("three"),d(null,3)},150)};async.applyEachSeries([c,d,e],5,function(){a.same(b,["one","two","three"]),a.done()})},exports["applyEach partial application"]=function(a){a.expect(4);var b=[],c=function(c,d){a.equal(c,5),setTimeout(function(){b.push("one"),d(null,1)},100)},d=function(c,d){a.equal(c,5),setTimeout(function(){b.push("two"),d(null,2)},50)},e=function(c,d){a.equal(c,5),setTimeout(function(){b.push("three"),d(null,3)},150)};async.applyEach([c,d,e])(5,function(){a.same(b,["two","one","three"]),a.done()})},exports.compose=function(a){a.expect(4);var b=function(b,c){a.equal(b,3),setTimeout(function(){c(null,b+2)},50)},c=function(b,c){a.equal(b,5),setTimeout(function(){c(null,3*b)},15)},d=function(b,c){a.equal(b,15),setTimeout(function(){c(null,b+1)},100)},e=async.compose(d,c,b);e(3,function(b,c){return b?a.done(b):(a.equal(c,16),void a.done())})},exports["compose error"]=function(a){a.expect(3);var b=new Error("test"),c=function(b,c){a.equal(b,3),setTimeout(function(){c(null,b+2)},50)},d=function(c,d){a.equal(c,5),setTimeout(function(){d(b)},15)},e=function(b,c){a.ok(!1,"add1 should not get called"),setTimeout(function(){c(null,b+1)},100)},f=async.compose(e,d,c);f(3,function(c){a.equal(c,b),a.done()})},exports["compose binding"]=function(a){a.expect(4);var b=(new Error("test"),{name:"foo"}),c=function(c,d){a.equal(this,b),setTimeout(function(){d(null,c+2)},50)},d=function(c,d){a.equal(this,b),setTimeout(function(){d(null,3*c)},15)},e=async.compose(d,c);e.call(b,3,function(c,d){return c?a.done(c):(a.equal(this,b),a.equal(d,15),void a.done())})},exports.seq=function(a){a.expect(4);var b=function(b,c){a.equal(b,3),setTimeout(function(){c(null,b+2)},50)},c=function(b,c){a.equal(b,5),setTimeout(function(){c(null,3*b)},15)},d=function(b,c){a.equal(b,15),setTimeout(function(){c(null,b+1)},100)},e=async.seq(b,c,d);e(3,function(b,c){return b?a.done(b):(a.equal(c,16),void a.done())})},exports["seq error"]=function(a){a.expect(3);var b=new Error("test"),c=function(b,c){a.equal(b,3),setTimeout(function(){c(null,b+2)},50)},d=function(c,d){a.equal(c,5),setTimeout(function(){d(b)},15)},e=function(b,c){a.ok(!1,"add1 should not get called"),setTimeout(function(){c(null,b+1)},100)},f=async.seq(c,d,e);f(3,function(c){a.equal(c,b),a.done()})},exports["seq binding"]=function(a){a.expect(4);var b=(new Error("test"),{name:"foo"}),c=function(c,d){a.equal(this,b),setTimeout(function(){d(null,c+2)},50)},d=function(c,d){a.equal(this,b),setTimeout(function(){d(null,3*c)},15)},e=async.seq(c,d);e.call(b,3,function(c,d){return c?a.done(c):(a.equal(this,b),a.equal(d,15),void a.done())})},exports.auto=function(a){var b=[];async.auto({task1:["task2",function(a){setTimeout(function(){b.push("task1"),a()},25)}],task2:function(a){setTimeout(function(){b.push("task2"),a()},50)},task3:["task2",function(a){b.push("task3"),a()}],task4:["task1","task2",function(a){b.push("task4"),a()}],task5:["task2",function(a){setTimeout(function(){b.push("task5"),a()},0)}],task6:["task2",function(a){b.push("task6"),a()}]},function(){a.same(b,["task2","task6","task3","task5","task1","task4"]),a.done()})},exports["auto petrify"]=function(a){var b=[];async.auto({task1:["task2",function(a){setTimeout(function(){b.push("task1"),a()},100)}],task2:function(a){setTimeout(function(){b.push("task2"),a()},200)},task3:["task2",function(a){b.push("task3"),a()}],task4:["task1","task2",function(a){b.push("task4"),a()}]},function(){a.same(b,["task2","task3","task1","task4"]),a.done()})},exports["auto results"]=function(a){var b=[];async.auto({task1:["task2",function(c,d){a.same(d.task2,"task2"),setTimeout(function(){b.push("task1"),c(null,"task1a","task1b")},25)}],task2:function(a){setTimeout(function(){b.push("task2"),a(null,"task2")},50)},task3:["task2",function(c,d){a.same(d.task2,"task2"),b.push("task3"),c(null)}],task4:["task1","task2",function(c,d){a.same(d.task1,["task1a","task1b"]),a.same(d.task2,"task2"),b.push("task4"),c(null,"task4")}]},function(c,d){a.same(b,["task2","task3","task1","task4"]),a.same(d,{task1:["task1a","task1b"],task2:"task2",task3:void 0,task4:"task4"}),a.done()})},exports["auto empty object"]=function(a){async.auto({},function(){a.done()})},exports["auto error"]=function(a){a.expect(1),async.auto({task1:function(a){a("testerror")},task2:["task1",function(b){a.ok(!1,"task2 should not be called"),b()}],task3:function(a){a("testerror2")}},function(b){a.equals(b,"testerror")}),setTimeout(a.done,100)},exports["auto no callback"]=function(a){async.auto({task1:function(a){a()},task2:["task1",function(b){b(),a.done()}]})},exports["auto error should pass partial results"]=function(a){async.auto({task1:function(a){a(!1,"result1")},task2:["task1",function(a){a("testerror","result2")}],task3:["task2",function(){a.ok(!1,"task3 should not be called")}]},function(b,c){a.equals(b,"testerror"),a.equals(c.task1,"result1"),a.equals(c.task2,"result2"),a.done()})},exports["auto removeListener has side effect on loop iterator"]=function(a){async.auto({task1:["task3",function(){a.done()}],task2:["task3",function(){}],task3:function(a){a()}})},exports["auto calls callback multiple times"]=function(a){if("undefined"==typeof process)return void a.done();var b=0,c=require("domain").create();c.on("error",function(b){return b._test_error?void 0:a.done(b)}),c.run(function(){async.auto({task1:function(a){a(null)},task2:["task1",function(a){a(null)}]},function(){b++;var a=new Error("An error");throw a._test_error=!0,a})}),setTimeout(function(){a.equal(b,1,"Final auto callback should only be called once"),a.done()},10)},exports["auto modifying results causes final callback to run early"]=function(a){async.auto({task1:function(a,b){b.inserted=!0,a(null,"task1")},task2:function(a){setTimeout(function(){a(null,"task2")},50)},task3:function(a){setTimeout(function(){a(null,"task3")},100)}},function(b,c){a.equal(c.inserted,!0),a.ok(c.task3,"task3"),a.done()})},exports["retry when attempt succeeds"]=function(a){function b(a){d++,c--,c?a(!0):a(null,e)}var c=3,d=0,e="success";async.retry(b,function(b,c){a.equal(d,3,"did not retry the correct number of times"),a.equal(c,e,"did not return the expected result"),a.done()})},exports["retry when all attempts succeeds"]=function(a){function b(a){d++,a(e+d,f+d)}var c=3,d=0,e="ERROR",f="RESULT";async.retry(c,b,function(b,g){a.equal(d,3,"did not retry the correct number of times"),a.equal(b,e+c,"Incorrect error was returned"),a.equal(g,f+c,"Incorrect result was returned"),a.done()})},exports["retry as an embedded task"]=function(a){var b,c,d="RETRY";async.auto({foo:function(a,c){b=c,a(null,"FOO")},retry:async.retry(function(a,b){c=b,a(null,d)})},function(e,f){a.equal(f.retry,d,"Incorrect result was returned from retry function"),a.equal(b,c,"Incorrect results were passed to retry function"),a.done()})},exports.waterfall=function(a){a.expect(6);var b=[];async.waterfall([function(a){b.push("fn1"),setTimeout(function(){a(null,"one","two")},0)},function(c,d,e){b.push("fn2"),a.equals(c,"one"),a.equals(d,"two"),setTimeout(function(){e(null,c,d,"three")},25)},function(c,d,e,f){b.push("fn3"),a.equals(c,"one"),a.equals(d,"two"),a.equals(e,"three"),f(null,"four")},function(c,d){b.push("fn4"),a.same(b,["fn1","fn2","fn3","fn4"]),d(null,"test")}],function(){a.done()})},exports["waterfall empty array"]=function(a){async.waterfall([],function(){a.done()})},exports["waterfall non-array"]=function(a){async.waterfall({},function(b){a.equals(b.message,"First argument to waterfall must be an array of functions"),a.done()})},exports["waterfall no callback"]=function(a){async.waterfall([function(a){a()},function(b){b(),a.done()}])},exports["waterfall async"]=function(a){var b=[];async.waterfall([function(a){b.push(1),a(),b.push(2)},function(a){b.push(3),a()},function(){a.same(b,[1,2,3]),a.done()}])},exports["waterfall error"]=function(a){a.expect(1),async.waterfall([function(a){a("error")},function(b){a.ok(!1,"next function should not be called"),b()}],function(b){a.equals(b,"error")}),setTimeout(a.done,50)},exports["waterfall multiple callback calls"]=function(a){var b=[],c=[function(a){b.push(1),a(null,"one","two"),a(null,"one","two")},function(a,c,d){b.push(2),d(null,a,c,"three")},function(a,c,d,e){b.push(3),e(null,"four")},function(){b.push(4),c[3]=function(){b.push(4),a.same(b,[1,2,2,3,3,4,4]),a.done()}}];async.waterfall(c)},exports.parallel=function(a){var b=[];async.parallel([function(a){setTimeout(function(){b.push(1),a(null,1)},50)},function(a){setTimeout(function(){b.push(2),a(null,2)},100)},function(a){setTimeout(function(){b.push(3),a(null,3,3)},25)}],function(c,d){a.equals(c,null),a.same(b,[3,1,2]),a.same(d,[1,2,[3,3]]),a.done()})},exports["parallel empty array"]=function(a){async.parallel([],function(b,c){a.equals(b,null),a.same(c,[]),a.done()})},exports["parallel error"]=function(a){async.parallel([function(a){a("error",1)},function(a){a("error2",2)}],function(b){a.equals(b,"error")}),setTimeout(a.done,100)},exports["parallel no callback"]=function(a){async.parallel([function(a){a()},function(b){b(),a.done()}])},exports["parallel object"]=function(a){var b=[];async.parallel(getFunctionsObject(b),function(c,d){a.equals(c,null),a.same(b,[3,1,2]),a.same(d,{one:1,two:2,three:[3,3]}),a.done()})},exports["parallel limit"]=function(a){var b=[];async.parallelLimit([function(a){setTimeout(function(){b.push(1),a(null,1)},50)},function(a){setTimeout(function(){b.push(2),a(null,2)},100)},function(a){setTimeout(function(){b.push(3),a(null,3,3)},25)}],2,function(c,d){a.equals(c,null),a.same(b,[1,3,2]),a.same(d,[1,2,[3,3]]),a.done()})},exports["parallel limit empty array"]=function(a){async.parallelLimit([],2,function(b,c){a.equals(b,null),a.same(c,[]),a.done()})},exports["parallel limit error"]=function(a){async.parallelLimit([function(a){a("error",1)},function(a){a("error2",2)}],1,function(b){a.equals(b,"error")}),setTimeout(a.done,100)},exports["parallel limit no callback"]=function(a){async.parallelLimit([function(a){a()},function(b){b(),a.done()}],1)},exports["parallel limit object"]=function(a){var b=[];async.parallelLimit(getFunctionsObject(b),2,function(c,d){a.equals(c,null),a.same(b,[1,3,2]),a.same(d,{one:1,two:2,three:[3,3]}),a.done()})},exports.series=function(a){var b=[];async.series([function(a){setTimeout(function(){b.push(1),a(null,1)},25)},function(a){setTimeout(function(){b.push(2),a(null,2)},50)},function(a){setTimeout(function(){b.push(3),a(null,3,3)},15)}],function(c,d){a.equals(c,null),a.same(d,[1,2,[3,3]]),a.same(b,[1,2,3]),a.done()})},exports["series empty array"]=function(a){async.series([],function(b,c){a.equals(b,null),a.same(c,[]),a.done()})},exports["series error"]=function(a){a.expect(1),async.series([function(a){a("error",1)},function(b){a.ok(!1,"should not be called"),b("error2",2)}],function(b){a.equals(b,"error")}),setTimeout(a.done,100)},exports["series no callback"]=function(a){async.series([function(a){a()},function(b){b(),a.done()}])},exports["series object"]=function(a){var b=[];async.series(getFunctionsObject(b),function(c,d){a.equals(c,null),a.same(d,{one:1,two:2,three:[3,3]}),a.same(b,[1,2,3]),a.done()})},exports.iterator=function(a){var b=[],c=async.iterator([function(){b.push(1)},function(c){a.equals(c,"arg1"),b.push(2)},function(c,d){a.equals(c,"arg1"),a.equals(d,"arg2"),b.push(3)}]);c(),a.same(b,[1]);var d=c();a.same(b,[1,1]);var e=d("arg1");a.same(b,[1,1,2]);var f=e("arg1","arg2");a.same(b,[1,1,2,3]),a.equals(f,void 0),a.done()},exports["iterator empty array"]=function(a){var b=async.iterator([]);a.equals(b(),void 0),a.equals(b.next(),void 0),a.done()},exports["iterator.next"]=function(a){var b=[],c=async.iterator([function(){b.push(1)},function(c){a.equals(c,"arg1"),b.push(2)},function(c,d){a.equals(c,"arg1"),a.equals(d,"arg2"),b.push(3)}]),d=c.next(),e=d("arg1");a.same(b,[2]),e("arg1","arg2"),a.same(b,[2,3]),a.equals(e.next(),void 0),a.done()},exports.each=function(a){var b=[];async.each([1,3,2],eachIterator.bind(this,b),function(){a.same(b,[1,2,3]),a.done()})},exports["each extra callback"]=function(a){var b=0;async.each([1,3,2],function(c,d){b++,d(),a.throws(d),3==b&&a.done()})},exports["each empty array"]=function(a){a.expect(1),async.each([],function(b,c){a.ok(!1,"iterator should not be called"),c()},function(){a.ok(!0,"should call callback")}),setTimeout(a.done,25)},exports["each error"]=function(a){a.expect(1),async.each([1,2,3],function(a,b){b("error")},function(b){a.equals(b,"error")}),setTimeout(a.done,50)},exports["each no callback"]=function(a){async.each([1],eachNoCallbackIterator.bind(this,a))},exports["forEach alias"]=function(a){a.strictEqual(async.each,async.forEach),a.done()},exports.eachSeries=function(a){var b=[];async.eachSeries([1,3,2],eachIterator.bind(this,b),function(){a.same(b,[1,3,2]),a.done()})},exports["eachSeries empty array"]=function(a){a.expect(1),async.eachSeries([],function(b,c){a.ok(!1,"iterator should not be called"),c()},function(){a.ok(!0,"should call callback")}),setTimeout(a.done,25)},exports["eachSeries error"]=function(a){a.expect(2);var b=[];async.eachSeries([1,2,3],function(a,c){b.push(a),c("error")},function(c){a.same(b,[1]),a.equals(c,"error")}),setTimeout(a.done,50)},exports["eachSeries no callback"]=function(a){async.eachSeries([1],eachNoCallbackIterator.bind(this,a))},exports["forEachSeries alias"]=function(a){a.strictEqual(async.eachSeries,async.forEachSeries),a.done()},exports.eachLimit=function(a){var b=[],c=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(c,2,function(a,c){setTimeout(function(){b.push(a),c()},5*a)},function(){a.same(b,c),a.done()})},exports["eachLimit empty array"]=function(a){a.expect(1),async.eachLimit([],2,function(b,c){a.ok(!1,"iterator should not be called"),c()},function(){a.ok(!0,"should call callback")}),setTimeout(a.done,25)},exports["eachLimit limit exceeds size"]=function(a){var b=[],c=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(c,20,eachIterator.bind(this,b),function(){a.same(b,c),a.done()})},exports["eachLimit limit equal size"]=function(a){var b=[],c=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(c,10,eachIterator.bind(this,b),function(){a.same(b,c),a.done()})},exports["eachLimit zero limit"]=function(a){a.expect(1),async.eachLimit([0,1,2,3,4,5],0,function(b,c){a.ok(!1,"iterator should not be called"),c()},function(){a.ok(!0,"should call callback")}),setTimeout(a.done,25)},exports["eachLimit error"]=function(a){a.expect(2);var b=[0,1,2,3,4,5,6,7,8,9],c=[];async.eachLimit(b,3,function(a,b){c.push(a),2===a&&b("error")},function(b){a.same(c,[0,1,2]),a.equals(b,"error")}),setTimeout(a.done,25)},exports["eachLimit no callback"]=function(a){async.eachLimit([1],1,eachNoCallbackIterator.bind(this,a))},exports["eachLimit synchronous"]=function(a){var b=[],c=[0,1,2];async.eachLimit(c,5,function(a,c){b.push(a),c()},function(){a.same(b,c),a.done()})},exports["forEachLimit alias"]=function(a){a.strictEqual(async.eachLimit,async.forEachLimit),a.done()},exports.map=function(a){var b=[];async.map([1,3,2],mapIterator.bind(this,b),function(c,d){a.same(b,[1,2,3]),a.same(d,[2,6,4]),a.done()})},exports["map original untouched"]=function(a){var b=[1,2,3];async.map(b,function(a,b){b(null,2*a)},function(c,d){a.same(d,[2,4,6]),a.same(b,[1,2,3]),a.done()})},exports["map without main callback"]=function(a){var b=[1,2,3],c=[];async.map(b,function(d,e){c.push(d),e(null),c.length>=b.length&&(a.same(c,b),a.done())})},exports["map error"]=function(a){a.expect(1),async.map([1,2,3],function(a,b){b("error")},function(b){a.equals(b,"error")}),setTimeout(a.done,50)},exports.mapSeries=function(a){var b=[];async.mapSeries([1,3,2],mapIterator.bind(this,b),function(c,d){a.same(b,[1,3,2]),a.same(d,[2,6,4]),a.done()})},exports["mapSeries error"]=function(a){a.expect(1),async.mapSeries([1,2,3],function(a,b){b("error")},function(b){a.equals(b,"error")}),setTimeout(a.done,50)},exports.mapLimit=function(a){var b=[];async.mapLimit([2,4,3],2,mapIterator.bind(this,b),function(c,d){a.same(b,[2,4,3]),a.same(d,[4,8,6]),a.done()})},exports["mapLimit empty array"]=function(a){a.expect(1),async.mapLimit([],2,function(b,c){a.ok(!1,"iterator should not be called"),c()},function(){a.ok(!0,"should call callback")}),setTimeout(a.done,25)},exports["mapLimit limit exceeds size"]=function(a){var b=[];async.mapLimit([0,1,2,3,4,5,6,7,8,9],20,mapIterator.bind(this,b),function(c,d){a.same(b,[0,1,2,3,4,5,6,7,8,9]),a.same(d,[0,2,4,6,8,10,12,14,16,18]),a.done()})},exports["mapLimit limit equal size"]=function(a){var b=[];async.mapLimit([0,1,2,3,4,5,6,7,8,9],10,mapIterator.bind(this,b),function(c,d){a.same(b,[0,1,2,3,4,5,6,7,8,9]),a.same(d,[0,2,4,6,8,10,12,14,16,18]),a.done()})},exports["mapLimit zero limit"]=function(a){a.expect(2),async.mapLimit([0,1,2,3,4,5],0,function(b,c){a.ok(!1,"iterator should not be called"),c()},function(b,c){a.same(c,[]),a.ok(!0,"should call callback")}),setTimeout(a.done,25)},exports["mapLimit error"]=function(a){a.expect(2);var b=[0,1,2,3,4,5,6,7,8,9],c=[];async.mapLimit(b,3,function(a,b){c.push(a),2===a&&b("error")},function(b){a.same(c,[0,1,2]),a.equals(b,"error")}),setTimeout(a.done,25)},exports.reduce=function(a){var b=[];async.reduce([1,2,3],0,function(a,c,d){b.push(c),d(null,a+c)},function(c,d){a.equals(d,6),a.same(b,[1,2,3]),a.done()})},exports["reduce async with non-reference memo"]=function(a){async.reduce([1,3,2],0,function(a,b,c){setTimeout(function(){c(null,a+b)},100*Math.random())},function(b,c){a.equals(c,6),a.done()})},exports["reduce error"]=function(a){a.expect(1),async.reduce([1,2,3],0,function(a,b,c){c("error")},function(b){a.equals(b,"error")}),setTimeout(a.done,50)},exports["inject alias"]=function(a){a.equals(async.inject,async.reduce),a.done()},exports["foldl alias"]=function(a){a.equals(async.foldl,async.reduce),a.done()},exports.reduceRight=function(a){var b=[],c=[1,2,3];async.reduceRight(c,0,function(a,c,d){b.push(c),d(null,a+c)},function(d,e){a.equals(e,6),a.same(b,[3,2,1]),a.same(c,[1,2,3]),a.done()})},exports["foldr alias"]=function(a){a.equals(async.foldr,async.reduceRight),a.done()},exports.filter=function(a){async.filter([3,1,2],filterIterator,function(b){a.same(b,[3,1]),a.done()})},exports["filter original untouched"]=function(a){var b=[3,1,2];async.filter(b,function(a,b){b(a%2)},function(c){a.same(c,[3,1]),a.same(b,[3,1,2]),a.done()})},exports.filterSeries=function(a){async.filterSeries([3,1,2],filterIterator,function(b){a.same(b,[3,1]),a.done()})},exports["select alias"]=function(a){a.equals(async.select,async.filter),a.done()},exports["selectSeries alias"]=function(a){a.equals(async.selectSeries,async.filterSeries),a.done()},exports.reject=function(a){async.reject([3,1,2],filterIterator,function(b){a.same(b,[2]),a.done()})},exports["reject original untouched"]=function(a){var b=[3,1,2];async.reject(b,function(a,b){b(a%2)},function(c){a.same(c,[2]),a.same(b,[3,1,2]),a.done()})},exports.rejectSeries=function(a){async.rejectSeries([3,1,2],filterIterator,function(b){a.same(b,[2]),a.done()})},exports["some true"]=function(a){async.some([3,1,2],function(a,b){setTimeout(function(){b(1===a)},0)},function(b){a.equals(b,!0),a.done()})},exports["some false"]=function(a){async.some([3,1,2],function(a,b){setTimeout(function(){b(10===a)},0)},function(b){a.equals(b,!1),a.done()})},exports["some early return"]=function(a){var b=[];async.some([1,2,3],function(a,c){setTimeout(function(){b.push(a),c(1===a)},25*a)},function(){b.push("callback")}),setTimeout(function(){a.same(b,[1,"callback",2,3]),a.done()},100)},exports["any alias"]=function(a){a.equals(async.any,async.some),a.done()},exports["every true"]=function(a){async.every([1,2,3],function(a,b){setTimeout(function(){b(!0)},0)},function(b){a.equals(b,!0),a.done()})},exports["every false"]=function(a){async.every([1,2,3],function(a,b){setTimeout(function(){b(a%2)},0)},function(b){a.equals(b,!1),a.done()})},exports["every early return"]=function(a){var b=[];async.every([1,2,3],function(a,c){setTimeout(function(){b.push(a),c(1===a)},25*a)},function(){b.push("callback")}),setTimeout(function(){a.same(b,[1,2,"callback",3]),a.done()},100)},exports["all alias"]=function(a){a.equals(async.all,async.every),a.done()},exports.detect=function(a){var b=[];async.detect([3,2,1],detectIterator.bind(this,b),function(c){b.push("callback"),a.equals(c,2)}),setTimeout(function(){a.same(b,[1,2,"callback",3]),a.done()},100)},exports["detect - mulitple matches"]=function(a){var b=[];async.detect([3,2,2,1,2],detectIterator.bind(this,b),function(c){b.push("callback"),a.equals(c,2)}),setTimeout(function(){a.same(b,[1,2,"callback",2,2,3]),a.done()},100)},exports.detectSeries=function(a){var b=[];async.detectSeries([3,2,1],detectIterator.bind(this,b),function(c){b.push("callback"),a.equals(c,2)}),setTimeout(function(){a.same(b,[3,2,"callback"]),a.done()},200)},exports["detectSeries - multiple matches"]=function(a){var b=[];async.detectSeries([3,2,2,1,2],detectIterator.bind(this,b),function(c){b.push("callback"),a.equals(c,2)}),setTimeout(function(){a.same(b,[3,2,"callback"]),a.done()},200)},exports.sortBy=function(a){async.sortBy([{a:1},{a:15},{a:6}],function(a,b){setTimeout(function(){b(null,a.a)},0)},function(b,c){a.same(c,[{a:1},{a:6},{a:15}]),a.done()})},exports["sortBy inverted"]=function(a){async.sortBy([{a:1},{a:15},{a:6}],function(a,b){setTimeout(function(){b(null,-1*a.a)},0)},function(b,c){a.same(c,[{a:15},{a:6},{a:1}]),a.done()})},exports.apply=function(a){a.expect(6);var b=function(){a.same(Array.prototype.slice.call(arguments),[1,2,3,4])};async.apply(b,1,2,3,4)(),async.apply(b,1,2,3)(4),async.apply(b,1,2)(3,4),async.apply(b,1)(2,3,4),async.apply(b)(1,2,3,4),a.equals(async.apply(function(a){return"hello "+a},"world")(),"hello world"),a.done()};var console_fn_tests=function(a){"undefined"!=typeof console&&(exports[a]=function(b){b.expect(5);var c=function(a,c){b.equals(a,"one"),setTimeout(function(){c(null,"test")},0)},d=function(a,c){b.equals(a,"one"),setTimeout(function(){c("error")},0)},e=console[a],f=console.error;console[a]=function(c){b.equals(c,"test"),b.equals(arguments.length,1),console.error=function(c){b.equals(c,"error"),console[a]=e,console.error=f,b.done()},async[a](d,"one")},async[a](c,"one")},exports[a+" with multiple result params"]=function(b){var c=function(a){a(null,"one","two","three")},d=console[a],e=[];console[a]=function(a){e.push(a)},async[a](c),b.same(e,["one","two","three"]),console[a]=d,b.done()}),exports[a+" without console."+a]=function(b){if("undefined"!=typeof window){var c=window.console;window.console=void 0;var d=function(a){a(null,"val")},e=function(a){a("error")};async[a](d),async[a](e),window.console=c}b.done()}};exports.times=function(a){async.times(5,function(a,b){b(null,a)},function(b,c){a.same(c,[0,1,2,3,4]),a.done()})},exports.times=function(a){var b=[];async.times(3,function(a,c){setTimeout(function(){b.push(a),c()},25*a)},function(){a.same(b,[0,1,2]),a.done()})},exports["times 0"]=function(a){a.expect(1),async.times(0,function(b,c){a.ok(!1,"iterator should not be called"),c()},function(){a.ok(!0,"should call callback")}),setTimeout(a.done,25)},exports["times error"]=function(a){a.expect(1),async.times(3,function(a,b){b("error")},function(b){a.equals(b,"error")}),setTimeout(a.done,50)},exports.timesSeries=function(a){var b=[];async.timesSeries(5,function(a,c){setTimeout(function(){b.push(a),c(null,a)},100-10*a)},function(c,d){a.same(b,[0,1,2,3,4]),a.same(d,[0,1,2,3,4]),a.done()})},exports["timesSeries error"]=function(a){a.expect(1),async.timesSeries(5,function(a,b){b("error")},function(b){a.equals(b,"error")}),setTimeout(a.done,50)},console_fn_tests("log"),console_fn_tests("dir"),exports.nextTick=function(a){var b=[];async.nextTick(function(){b.push("two")}),b.push("one"),setTimeout(function(){a.same(b,["one","two"]),a.done()},50)},exports["nextTick in the browser"]=function(a){if("undefined"!=typeof process)return a.done();a.expect(1);var b=[];async.nextTick(function(){b.push("two")}),b.push("one"),setTimeout(function(){"undefined"!=typeof process&&(process.nextTick=_nextTick),a.same(b,["one","two"])},50),setTimeout(a.done,100)},exports["noConflict - node only"]=function(a){if("undefined"!=typeof process){a.expect(3);var b=require("fs"),c=__dirname+"/../lib/async.js";b.readFile(c,function(b,d){if(b)return a.done();var e=process.binding("evals").Script||process.binding("evals").NodeScript,f=new e(d,c),g=new e(d+"this.async2 = this.async.noConflict();",c),h={async:"oldvalue"};f.runInNewContext(h),a.ok(h.async);var i={async:"oldvalue"};g.runInNewContext(i),a.equals(i.async,"oldvalue"),a.ok(i.async2),a.done()})}else a.done()},exports.concat=function(a){var b=[],c=function(a,c){setTimeout(function(){b.push(a);for(var d=[];a>0;)d.push(a),a--;c(null,d)},25*a)};async.concat([1,3,2],c,function(c,d){a.same(d,[1,2,1,3,2,1]),a.same(b,[1,2,3]),a.ok(!c),a.done()})},exports["concat error"]=function(a){var b=function(a,b){b(new Error("test error"))};async.concat([1,2,3],b,function(b){a.ok(b),a.done()})},exports.concatSeries=function(a){var b=[],c=function(a,c){setTimeout(function(){b.push(a);for(var d=[];a>0;)d.push(a),a--;c(null,d)},25*a)};async.concatSeries([1,3,2],c,function(c,d){a.same(d,[1,3,2,1,2,1]),a.same(b,[1,3,2]),a.ok(!c),a.done()})},exports.until=function(a){var b=[],c=0;async.until(function(){return b.push(["test",c]),5==c},function(a){b.push(["iterator",c]),c++,a()},function(){a.same(b,[["test",0],["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),a.equals(c,5),a.done()})},exports.doUntil=function(a){var b=[],c=0;async.doUntil(function(a){b.push(["iterator",c]),c++,a()},function(){return b.push(["test",c]),5==c},function(){a.same(b,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),a.equals(c,5),a.done()})},exports["doUntil callback params"]=function(a){var b=[],c=0;async.doUntil(function(a){b.push(["iterator",c]),c++,a(null,c)},function(a){return b.push(["test",a]),5==a},function(){a.same(b,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),a.equals(c,5),a.done()})},exports.whilst=function(a){var b=[],c=0;async.whilst(function(){return b.push(["test",c]),5>c},function(a){b.push(["iterator",c]),c++,a()},function(){a.same(b,[["test",0],["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),a.equals(c,5),a.done()})},exports.doWhilst=function(a){var b=[],c=0;async.doWhilst(function(a){b.push(["iterator",c]),c++,a()},function(){return b.push(["test",c]),5>c},function(){a.same(b,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),a.equals(c,5),a.done()})},exports["doWhilst callback params"]=function(a){var b=[],c=0;async.doWhilst(function(a){b.push(["iterator",c]),c++,a(null,c)},function(a){return b.push(["test",a]),5>a},function(){a.same(b,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),a.equals(c,5),a.done()})},exports.queue=function(a){var b=[],c=[160,80,240,80],d=async.queue(function(a,d){setTimeout(function(){b.push("process "+a),d("error","arg")},c.splice(0,1)[0])},2);d.push(1,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),1),b.push("callback 1")}),d.push(2,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),2),b.push("callback 2")}),d.push(3,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),0),b.push("callback 3")}),d.push(4,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),0),b.push("callback 4")}),a.equal(d.length(),4),a.equal(d.concurrency,2),d.drain=function(){a.same(b,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),a.equal(d.concurrency,2),a.equal(d.length(),0),a.done()}},exports["queue default concurrency"]=function(a){var b=[],c=[160,80,240,80],d=async.queue(function(a,d){setTimeout(function(){b.push("process "+a),d("error","arg")},c.splice(0,1)[0])});d.push(1,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),3),b.push("callback 1")}),d.push(2,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),2),b.push("callback 2")}),d.push(3,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),1),b.push("callback 3")}),d.push(4,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),0),b.push("callback 4")}),a.equal(d.length(),4),a.equal(d.concurrency,1),d.drain=function(){a.same(b,["process 1","callback 1","process 2","callback 2","process 3","callback 3","process 4","callback 4"]),a.equal(d.concurrency,1),a.equal(d.length(),0),a.done()}},exports["queue error propagation"]=function(a){var b=[],c=async.queue(function(a,b){b("foo"===a.name?new Error("fooError"):null)},2);c.drain=function(){a.deepEqual(b,["bar","fooError"]),a.done()},c.push({name:"bar"},function(a){return a?void b.push("barError"):void b.push("bar")}),c.push({name:"foo"},function(a){return a?void b.push("fooError"):void b.push("foo")})},exports["queue changing concurrency"]=function(a){var b=[],c=[40,20,60,20],d=async.queue(function(a,d){setTimeout(function(){b.push("process "+a),d("error","arg")},c.splice(0,1)[0])},2);d.push(1,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),3),b.push("callback 1")}),d.push(2,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),2),b.push("callback 2")}),d.push(3,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),1),b.push("callback 3")}),d.push(4,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),0),b.push("callback 4")}),a.equal(d.length(),4),a.equal(d.concurrency,2),d.concurrency=1,setTimeout(function(){a.same(b,["process 1","callback 1","process 2","callback 2","process 3","callback 3","process 4","callback 4"]),a.equal(d.concurrency,1),a.equal(d.length(),0),a.done()},250)},exports["queue push without callback"]=function(a){var b=[],c=[160,80,240,80],d=async.queue(function(a,d){setTimeout(function(){b.push("process "+a),d("error","arg")},c.splice(0,1)[0])},2);d.push(1),d.push(2),d.push(3),d.push(4),setTimeout(function(){a.same(b,["process 2","process 1","process 4","process 3"]),a.done()},800)},exports["queue unshift"]=function(a){var b=[],c=async.queue(function(a,c){b.push(a),c()
},1);c.unshift(4),c.unshift(3),c.unshift(2),c.unshift(1),setTimeout(function(){a.same(b,[1,2,3,4]),a.done()},100)},exports["queue too many callbacks"]=function(a){var b=async.queue(function(b,c){c(),a.throws(function(){c()}),a.done()},2);b.push(1)},exports["queue bulk task"]=function(a){var b=[],c=[160,80,240,80],d=async.queue(function(a,d){setTimeout(function(){b.push("process "+a),d("error",a)},c.splice(0,1)[0])},2);d.push([1,2,3,4],function(c,d){a.equal(c,"error"),b.push("callback "+d)}),a.equal(d.length(),4),a.equal(d.concurrency,2),setTimeout(function(){a.same(b,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),a.equal(d.concurrency,2),a.equal(d.length(),0),a.done()},800)},exports["queue idle"]=function(a){var b=async.queue(function(c,d){a.equal(b.idle(),!1),d()},1);a.equal(b.idle(),!0),b.unshift(4),b.unshift(3),b.unshift(2),b.unshift(1),a.equal(b.idle(),!1),b.drain=function(){a.equal(b.idle(),!0),a.done()}},exports["queue pause"]=function(a){function b(){var a=g.shift();a&&setTimeout(function(){i.push(a),b()},d)}var c=[],d=100,e=300,f=500,g=[1,2,3,4,5,6],h=function(){var a=+Date.now();return function(){return 100*Math.floor((+Date.now()-a)/100)}}(),i=async.queue(function(a,b){c.push("process "+a),c.push("timeout "+h()),b()});b(),setTimeout(function(){i.pause(),a.equal(i.paused,!0)},e),setTimeout(function(){i.resume(),a.equal(i.paused,!1)},f),setTimeout(function(){a.same(c,["process 1","timeout 100","process 2","timeout 200","process 3","timeout 500","process 4","timeout 500","process 5","timeout 500","process 6","timeout 600"]),a.done()},800)},exports["queue kill"]=function(a){var b=async.queue(function(b,c){setTimeout(function(){a.ok(!1,"Function should never be called"),c()},300)},1);b.drain=function(){a.ok(!1,"Function should never be called")},b.push(0),b.kill(),setTimeout(function(){a.equal(b.length(),0),a.done()},600)},exports.priorityQueue=function(a){var b=[],c=async.priorityQueue(function(a,c){b.push("process "+a),c("error","arg")},1);c.push(1,1.4,function(d,e){a.equal(d,"error"),a.equal(e,"arg"),a.equal(c.length(),2),b.push("callback 1")}),c.push(2,.2,function(d,e){a.equal(d,"error"),a.equal(e,"arg"),a.equal(c.length(),3),b.push("callback 2")}),c.push(3,3.8,function(d,e){a.equal(d,"error"),a.equal(e,"arg"),a.equal(c.length(),0),b.push("callback 3")}),c.push(4,2.9,function(d,e){a.equal(d,"error"),a.equal(e,"arg"),a.equal(c.length(),1),b.push("callback 4")}),a.equal(c.length(),4),a.equal(c.concurrency,1),c.drain=function(){a.same(b,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),a.equal(c.concurrency,1),a.equal(c.length(),0),a.done()}},exports["priorityQueue concurrency"]=function(a){var b=[],c=[160,80,240,80],d=async.priorityQueue(function(a,d){setTimeout(function(){b.push("process "+a),d("error","arg")},c.splice(0,1)[0])},2);d.push(1,1.4,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),2),b.push("callback 1")}),d.push(2,.2,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),1),b.push("callback 2")}),d.push(3,3.8,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),0),b.push("callback 3")}),d.push(4,2.9,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),0),b.push("callback 4")}),a.equal(d.length(),4),a.equal(d.concurrency,2),d.drain=function(){a.same(b,["process 1","callback 1","process 2","callback 2","process 3","callback 3","process 4","callback 4"]),a.equal(d.concurrency,2),a.equal(d.length(),0),a.done()}},exports.cargo=function(a){var b=[],c=[160,160,80],d=async.cargo(function(a,d){setTimeout(function(){b.push("process "+a.join(" ")),d("error","arg")},c.shift())},2);d.push(1,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),3),b.push("callback 1")}),d.push(2,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),3),b.push("callback 2")}),a.equal(d.length(),2),setTimeout(function(){d.push(3,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),1),b.push("callback 3")})},60),setTimeout(function(){d.push(4,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),1),b.push("callback 4")}),a.equal(d.length(),2),d.push(5,function(c,e){a.equal(c,"error"),a.equal(e,"arg"),a.equal(d.length(),0),b.push("callback 5")})},120),setTimeout(function(){a.same(b,["process 1 2","callback 1","callback 2","process 3 4","callback 3","callback 4","process 5","callback 5"]),a.equal(d.length(),0),a.done()},800)},exports["cargo without callback"]=function(a){var b=[],c=[160,80,240,80],d=async.cargo(function(a,d){setTimeout(function(){b.push("process "+a.join(" ")),d("error","arg")},c.shift())},2);d.push(1),setTimeout(function(){d.push(2)},120),setTimeout(function(){d.push(3),d.push(4),d.push(5)},180),setTimeout(function(){a.same(b,["process 1","process 2","process 3 4","process 5"]),a.done()},800)},exports["cargo bulk task"]=function(a){var b=[],c=[120,40],d=async.cargo(function(a,d){setTimeout(function(){b.push("process "+a.join(" ")),d("error",a.join(" "))},c.shift())},3);d.push([1,2,3,4],function(c,d){a.equal(c,"error"),b.push("callback "+d)}),a.equal(d.length(),4),setTimeout(function(){a.same(b,["process 1 2 3","callback 1 2 3","callback 1 2 3","callback 1 2 3","process 4","callback 4"]),a.equal(d.length(),0),a.done()},800)},exports["cargo drain once"]=function(a){var b=async.cargo(function(a,b){b()},3),c=0;b.drain=function(){c++};for(var d=0;10>d;d++)b.push(d);setTimeout(function(){a.equal(c,1),a.done()},500)},exports["cargo drain twice"]=function(a){var b=async.cargo(function(a,b){b()},3),c=function(){for(var a=0;10>a;a++)b.push(a)},d=0;b.drain=function(){d++},c(),setTimeout(c,500),setTimeout(function(){a.equal(d,2),a.done()},1e3)},exports.memoize=function(a){a.expect(4);var b=[],c=function(a,c,d){async.setImmediate(function(){b.push(["fn",a,c]),d(null,a+c)})},d=async.memoize(c);d(1,2,function(c,e){a.equal(e,3),d(1,2,function(c,e){a.equal(e,3),d(2,2,function(c,d){a.equal(d,4),a.same(b,[["fn",1,2],["fn",2,2]]),a.done()})})})},exports["memoize maintains asynchrony"]=function(a){function b(){var b=[["fn",1,2],"tick1",["cb",1,2],"tick2","tick3"];a.same(c,b),a.done()}a.expect(3);var c=[],d=function(a,b,d){c.push(["fn",a,b]),async.setImmediate(function(){c.push(["cb",a,b]),d(null,a+b)})},e=async.memoize(d);e(1,2,function(d,f){a.equal(f,3),e(1,2,function(d,e){a.equal(e,3),async.nextTick(b),c.push("tick3")}),c.push("tick2")}),c.push("tick1")},exports.unmemoize=function(a){a.expect(4);var b=[],c=function(a,c,d){b.push(["fn",a,c]),async.setImmediate(function(){d(null,a+c)})},d=async.memoize(c),e=async.unmemoize(d);e(1,2,function(c,d){a.equal(d,3),e(1,2,function(c,d){a.equal(d,3),e(2,2,function(c,d){a.equal(d,4),a.same(b,[["fn",1,2],["fn",1,2],["fn",2,2]]),a.done()})})})},exports["unmemoize a not memoized function"]=function(a){a.expect(1);var b=function(a,b,c){c(null,a+b)},c=async.unmemoize(b);c(1,2,function(b,c){a.equal(c,3)}),a.done()},exports["memoize error"]=function(a){a.expect(1);var b=new Error("test"),c=function(a,c,d){d(b,a+c)};async.memoize(c)(1,2,function(c){a.equal(c,b)}),a.done()},exports["memoize multiple calls"]=function(a){a.expect(3);var b=function(b,c,d){a.ok(!0),setTimeout(function(){d(null,b,c)},10)},c=async.memoize(b);c(1,2,function(b,c){a.equal(c,1,2)}),c(1,2,function(b,c){a.equal(c,1,2),a.done()})},exports["memoize custom hash function"]=function(a){a.expect(2);var b=new Error("test"),c=function(a,c,d){d(b,a+c)},d=async.memoize(c,function(){return"custom hash"});d(1,2,function(b,c){a.equal(c,3),d(2,2,function(b,c){a.equal(c,3),a.done()})})},exports["memoize manually added memo value"]=function(a){a.expect(1);var b=async.memoize(function(){a(!1,"Function should never be called")});b.memo.foo=["bar"],b("foo",function(b){a.equal(b,"bar"),a.done()})},exports["falsy return values in series"]=function(a){function b(a){async.nextTick(function(){a(null,!1)})}function c(a){async.nextTick(function(){a(null,void 0)})}function d(a){async.nextTick(function(){a(null)})}function e(a){async.nextTick(function(){a(null,null)})}async.series([b,c,d,e],function(b,c){a.equal(c.length,4),a.strictEqual(c[0],!1),a.strictEqual(c[1],void 0),a.strictEqual(c[2],void 0),a.strictEqual(c[3],null),a.done()})},exports["falsy return values in parallel"]=function(a){function b(a){async.nextTick(function(){a(null,!1)})}function c(a){async.nextTick(function(){a(null,void 0)})}function d(a){async.nextTick(function(){a(null)})}function e(a){async.nextTick(function(){a(null,null)})}async.parallel([b,c,d,e],function(b,c){a.equal(c.length,4),a.strictEqual(c[0],!1),a.strictEqual(c[1],void 0),a.strictEqual(c[2],void 0),a.strictEqual(c[3],null),a.done()})},exports["queue events"]=function(a){var b=[],c=async.queue(function(a,c){b.push("process "+a),async.setImmediate(c)},10);c.concurrency=3,c.saturated=function(){a.ok(3==c.length(),"queue should be saturated now"),b.push("saturated")},c.empty=function(){a.ok(0==c.length(),"queue should be empty now"),b.push("empty")},c.drain=function(){a.ok(0==c.length()&&0==c.running(),"queue should be empty now and no more workers should be running"),b.push("drain"),a.same(b,["saturated","process foo","process bar","process zoo","foo cb","process poo","bar cb","empty","process moo","zoo cb","poo cb","moo cb","drain"]),a.done()},c.push("foo",function(){b.push("foo cb")}),c.push("bar",function(){b.push("bar cb")}),c.push("zoo",function(){b.push("zoo cb")}),c.push("poo",function(){b.push("poo cb")}),c.push("moo",function(){b.push("moo cb")})},exports["queue empty"]=function(a){var b=[],c=async.queue(function(a,c){b.push("process "+a),async.setImmediate(c)},3);c.drain=function(){a.ok(0==c.length()&&0==c.running(),"queue should be empty now and no more workers should be running"),b.push("drain"),a.same(b,["drain"]),a.done()},c.push([])},exports["queue started"]=function(a){var b=async.queue(function(){});a.equal(b.started,!1),b.push([]),a.equal(b.started,!0),a.done()};