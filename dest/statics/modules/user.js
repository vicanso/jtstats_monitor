(function(){define("user",["jquery","underscore","async","Backbone"],function(a,b){var c,d,e,f,g,h,i;c=a("jquery"),i=a("underscore"),f=a("async"),d=a("Backbone"),g=function(){},i.extend(b,d.Events),e=d.Model.extend({url:function(){return"/user?cache=false"},initialize:function(){return this.fetch()}}),h=new e,h.on("change:anonymous",function(a,c){var d;return d="logged",c&&(d="unlogged"),"logged"===d&&h.set("id","vicanso"),b.trigger("status",d)}),b.isLogedIn=function(){return!h.get("anonymous")},b.logOut=function(){return h.destroy({success:function(a,b){return h.set("name",""),h.set("id",""),i.each(b,function(a,b){return h.set(b,a)})},error:function(){return console.dir("error")}})},b.logIn=function(){var a,b,d;return d=c('<div class="maskContainer" />').appendTo("body"),b='<div class="logInDialog"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a href="javascript:;" class="glyphicon glyphicon-remove close"></a>登录</h3></div></div><div class="panel-body"><input type="text" class="form-control user" autofocus placeholder="用户名" /><input type="password" class="form-control password" autofocus placeholder="密码" /><div class="alert hidden"></div><div class="row"><div class="col-xs-6"><a href="javascript:;" class="btn btn-success register">注册</a></div><div class="col-xs-6"><a href="javascript:;" class="btn btn-primary logIn">登录</a></div></div></div></div>',a=c(b).appendTo("body"),a.on("click",".close, .logIn, .register",function(){var b,e,f,g,j,k,l;return e=c(this),e.hasClass("logIn")||e.hasClass("register")?(k=a.find("input.user"),(l=k.val().trim())?(g=a.find("input.password"),(f=g.val().trim())?(b=a.find(".alert"),b.removeClass("alert-warning hidden"),b.addClass("alert-info"),b.text("正在提交中，请稍候..."),j="logIn",e.hasClass("register")&&(j="register"),seajs.use("crypto",function(c){var e;return h.set("type",j),e=c.SHA1(f).toString(),"logIn"===j&&(e=c.SHA1(""+e+"_"+h.get("hash")).toString()),h.set("pwd",e),h.set("name",l),h.save({},{error:function(){return b.removeClass("alert-info").addClass("alert-warning"),b.text("register"===j?"注册失败！":"登录失败！")},success:function(b,c){return i.each(c,function(a,c){return b.set(c,a)}),a.remove(),d.remove()}})})):void g.focus()):void k.focus()):(a.remove(),d.remove())})},b.get=function(a){return h.get(a)}})}).call(this);