(function(){define("user",["jquery","underscore","async","Backbone"],function(a,b){var c,d,e,f,g,h,i;c=a("jquery"),i=a("underscore"),f=a("async"),d=a("Backbone"),g=function(){},i.extend(b,d.Events),e=d.Model.extend({defaults:{anonymous:""},url:function(){return"/user?cache=false"},initialize:function(){return this.fetch()}}),h=new e,h.on("change:anonymous",function(a,c){var d;return d="logged",c&&(d="unlogged"),"logged"===d&&h.set("id","vicanso"),b.trigger("status",d)}),b.isLogedIn=function(){return!h.get("anonymous")},b.logOut=function(){return h.destroy({success:function(a,b){return h.set("name",""),h.set("id",""),i.each(b,function(a,b){return h.set(b,a)})},error:function(){return console.dir("error")}})},b.logIn=function(){var a,b,d;return d=c('<div class="maskContainer" />').appendTo("body"),b='<div class="logInDialog"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a href="javascript:;" class="glyphicon glyphicon-remove close"></a>登录</h3></div></div><div class="panel-body"><input type="text" class="form-control user" autofocus placeholder="用户名" /><input type="password" class="form-control password" autofocus placeholder="密码" /><div class="alert hidden"></div><div class="row"><div class="col-xs-6"><a href="javascript:;" class="btn btn-success register">注册</a></div><div class="col-xs-6"><a href="javascript:;" class="btn btn-primary logIn">登录</a></div></div></div></div>',a=c(b).appendTo("body"),a.on("click",".close, .logIn, .register",function(){var b,e,f,g,j,k,l;return e=c(this),e.hasClass("logIn")||e.hasClass("register")?(k=a.find("input.user"),(l=k.val().trim())?(g=a.find("input.password"),(f=g.val().trim())?(b=a.find(".alert"),b.removeClass("alert-warning hidden"),b.addClass("alert-info"),b.text("正在提交中，请稍候..."),j="logIn",e.hasClass("register")&&(j="register"),seajs.use("crypto",function(c){var e;return h.set("type",j),e=c.SHA1(f).toString(),"logIn"===j&&(e=c.SHA1(""+e+"_"+h.get("hash")).toString()),h.set("pwd",e),h.set("name",l),h.save({},{error:function(){return b.removeClass("alert-info").addClass("alert-warning"),b.text("register"===j?"注册失败！":"登录失败！")},success:function(b,c){return i.each(c,function(a,c){return b.set(c,a)}),a.remove(),d.remove()}})})):void g.focus()):void k.focus()):(a.remove(),d.remove())})},b.get=function(a){return h.get(a)}})}).call(this);
(function(){define("widget",["jquery","underscore","Backbone","debug"],function(a,b){var c,d,e,f,g;g=a("underscore"),c=a("jquery"),d=a("Backbone"),f=a("debug")("module:widget"),e=d.Model.extend({defaults:{edit:!1,placeholder:"",selectTips:"",multi:!1}}),b.Selector=d.View.extend({template:g.template('<div class="content"><span class="glyphicon glyphicon-plus"></span><a class="edit" href="javascript:;"><span class="glyphicon glyphicon-edit"></span></a><div class="userInput hidden"><input type="text" placeholder="<%= placeholder %>" /></div><span class="selectInput"><span class="placeholder"><%= selectTips %></span><span class="items"></span></span></div><ul class="selectList"><div class="arrowTop1"></div><div class="arrowTop2"></div><%= html %></ul>'),colors:["#0c92c9","#0cc99a","#ffd200","#ff7f02","#ff0202","#ff02af","#c20cff","#4c16ff","#1f63ff","#28fff7"],events:{"click .selectList li":"toggle","click .content .edit":"toggleEdit"},initialize:function(a){return a=g.omit(a,"el"),f("initialize selector %j",a),this.model=new e(a),this.listenTo(this.model,"change:edit",this.editModeChange),this.listenTo(this.model,"change:items",this.render),this.render(),this},toggleEdit:function(){return this.model.set("edit",!this.model.get("edit"))},editModeChange:function(a,b){var c,d,e;return c=this.$el,e=c.find(".content .userInput"),d=c.find(".content .selectInput"),c.find(".content .userInput, .content .selectInput").toggleClass("hidden"),b?c.addClass("editMode"):c.removeClass("editMode")},options:function(a){return a?this.model.set("items",a):this.model.get("items")},getSelectListHtml:function(){var a,b;return b=g.template('<li><span class="checkIcon"></span><span class="dot" style="background-color:<%= color %>;"></span><%= name %></li>'),a=g.map(this.model.get("items"),function(a){return function(c,d){var e;return e=a.colors[d%a.colors.length],b({name:c,color:e})}}(this)),a.join("")},toggle:function(a){var b,d,e,f,h;return e=c(a.currentTarget),this.model.get("multi")?e.hasClass("selected")?(e.removeClass("selected"),e.find(".checkIcon").removeClass("glyphicon glyphicon-ok")):(e.addClass("selected"),e.find(".checkIcon").addClass("glyphicon glyphicon-ok")):e.hasClass("selected")||(e.addClass("selected").find(".checkIcon").addClass("glyphicon glyphicon-ok"),e.siblings(".selected").removeClass("selected").find(".checkIcon").removeClass("glyphicon glyphicon-ok")),b=this.$el,h=this.$el.find(".selectList .selected"),d=g.map(h,function(a){return a=c(a),'<span class="item">'+a.html()+"</span>"}),f=b.find(".content .placeholder"),h.length?f.addClass("hidden"):f.removeClass("hidden"),b.find(".content .items").html(d.join("")),this.trigger("change")},render:function(){var a,b,c,d,e;return a=this.$el,c=this.getSelectListHtml(),d=this.model.get("placeholder"),e=this.model.get("selectTips"),b=this.model.toJSON(),b.html=c,a.addClass("uiSelector").html(this.template(b))},val:function(){var a;return a=this.model.get("edit")?[this.$el.find(".content .userInput input").val().trim()]:g.map(this.$el.find(".content .items .item"),function(a){return c(a).text()}),this.model.get("multi")?a:a[0]},reset:function(){return this.render()}})})}).call(this);
(function(){define("ChartView",["underscore","stats","chart","async"],function(a,b,c){var d,e,f,g,h;g=a("stats"),f=a("chart"),e=a("async"),h=a("underscore"),d=Backbone.View.extend({setOptions:function(a){this._options=a},show:function(){var a,b,c,d,i,j,k,l;return(j=this._options)?this._isLoading?void 0:(this._isLoading=!0,a=h.pick(j,["date","fill","point"]),d=null!=(l=a.point)?l.interval:void 0,k=j.type||"line",i=j.name,b=h.map(j.stats,function(b){return function(c){return b=h.extend({},a,b),g.getChartData(b,c)}}),(c=function(a){return function(c){return e.parallel(b,function(b,d){return a._isLoading=!1,b?c(b):(d=h.flatten(d,!0),c(null,d))})}}(this))(function(a){return function(b,e){var g;return b?alert(b):(j={title:{text:i||"未定义"},interval:d},-1===window.parseInt(d)&&(g=c),f[k](a.$el.get(0),e,j,g))}}(this))):void alert("options can not be null")}}),c.exports=d})}).call(this);
(function(){define("stats",["jquery","underscore"],function(a,b){var c,d,e;c=a("jquery"),e=a("underscore"),d=60,b.getChartData=function(a,b){return a.interval||(a.interval=d),c.ajax({url:"/stats",dataType:"json",data:a}).success(function(c){return e.isArray(c)?e.each(c,function(b){b.chart=a.chart}):c.chart=a.chart,b(null,c)}).error(b)},b.interval=function(a){return a&&a>0&&(d=a),d}})}).call(this);
(function(){define("chart",["jquery","underscore","echarts","moment","stats"],function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;p=a("underscore"),c=a("jquery"),j=a("echarts"),n=a("moment"),f=86400,g={tooltip:{trigger:"axis"},calculable:!0,toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},yAxis:[{type:"value"}],animation:!1},h={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0},restore:{show:!0},saveAsImage:{show:!0}},calculable:!0}},o=function(a){return p.reduce(a,function(a,b){return a+b},0)},d=function(a){var b;return b=o(a),Math.round(b/a.length)},m=function(a){var b,c;return c=p.map(a,function(a){return p.pluck(a.values,"t")}),b=c.shift(),p.each(c,function(a){return p.each(a,function(a){var c;return c=p.sortedIndex(b,a),b[c]!==a?b.splice(c,0,a):void 0})}),b},e=function(a,b){var c,d,e,f,g;for(e=p.pluck(a,"values"),d=[],c=f=0,g=e.length;g>=0?g>f:f>g;c=g>=0?++f:--f)d.push([]);return p.each(b,function(a){return p.each(e,function(b,c){var e,f;return(null!=(f=b[0])?f.t:void 0)===a?(e=b.shift(),d[c].push(e.v)):d[c].push(0)})}),d},k=function(a,b){var c;return c="YYYY-MM-DD HH:mm:ss",b&&(b%f===0?c="YYYY-MM-DD":b%3600===0?c="YYYY-MM-DD HH":b%60===0&&(c="YYYY-MM-DD HH:mm")),p.map(a,function(a){return n(1e3*a).format(c)})},l=function(a){var b;return b=50,a>b?{show:!0,realtime:!0,start:100-Math.floor(100*b/a),end:100}:null},b.line=function(a,b,c){var d,f,h,n,o;if(null!=b?b.length:void 0)return n=m(b),o=e(b,n),n=k(n,null!=c?c.interval:void 0),h=p.map(b,function(a,b){return{name:a.key,type:a.chart,data:o[b]}}),d=p.extend({},g,{legend:{data:p.pluck(b,"key")},dataZoom:l(n.length),xAxis:[{type:"category",boundaryGap:!1,data:n}],series:h},c),f=j.init(a,i),f.setOption(d,!0)},b.barVertical=b.line,b.stack=function(a,b,c){var d,f,h,n,o;if(null!=b?b.length:void 0)return n=m(b),o=e(b,n),n=k(n,null!=c?c.interval:void 0),h=p.map(b,function(a,b){return{name:a.key,type:a.chart,stack:"总量",data:o[b]}}),d=p.extend({},g,{legend:{data:p.pluck(b,"key")},dataZoom:l(n.length),xAxis:[{type:"category",boundaryGap:!1,data:n}],series:h},c),f=j.init(a,i),f.setOption(d,!0)},b.stackBarVertical=b.stack,b.barHorizontal=function(a,b,c,d){var f,h,n,o,q;return null==d&&(d=!1),(null!=b?b.length:void 0)?(o=m(b),q=e(b,o),o=k(o,null!=c?c.interval:void 0),n=p.map(b,function(a,b){var c;return c={name:a.key,type:a.chart,data:q[b]},d&&(c.stack="总量"),c}),f=p.extend({},g,{legend:{data:p.pluck(b,"key")},dataZoom:l(o.length),xAxis:[{type:"value",boundaryGap:[0,.01]}],yAxis:[{type:"category",data:o}],series:n},c),h=j.init(a,i),h.setOption(f,!0)):void 0},b.stackBarHorizontal=function(a,c,d){return b.barHorizontal(a,c,d,!0)},b.pie=function(a,b,c){var e,f;return b=p.map(b,function(a){var b,c;switch(c=p.pluck(a.values,"v"),a.type){case"counter":b=o(c);break;case"average":b=d(c);break;case"gauge":b=p.last(c)}return{name:a.key,value:b}}),c=p.extend({},h,{legend:{data:p.pluck(b,"name"),orient:"vertical",x:"left",y:"30px"},series:[{name:null!=c&&null!=(f=c.title)?f.text:void 0,type:"pie",data:b}],animation:!1},c),e=j.init(a,i),e.setOption(c,!0)},b.nestedPie=function(){},b.gauge=function(a,b,c){var d,e;return d=p.extend({toolbox:{show:!0,feature:{mark:{show:!0},restore:{show:!0},saveAsImage:{show:!0}}}},c),d.series=p.map(b,function(a){return{name:a.key,type:"gauge",detail:{formatter:"{value}"},data:[{value:a.values[0].v}]}}),e=j.init(a,i),e.setOption(d)},b.funnel=function(a,b,c){var e,f,g;return b=p.map(b,function(a){var b,c;switch(c=p.pluck(a.values,"v"),a.type){case"counter":b=o(c);break;case"average":b=d(c);break;case"gauge":b=p.last(c)}return{name:a.key,value:b}}),f=0,p.each(b,function(a){a.value>f&&(f=a.value)}),p.each(b,function(a){a.value=Math.floor(100*a.value/f)}),console.dir(b),e=p.extend({title:c.title,tooltip:{trigger:"item",formatter:"{b} : {c}%"},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:p.pluck(b,"name")},calculable:!0,series:[{type:"funnel",data:b}]}),g=j.init(a,i),g.setOption(e,!0)},b.columnFresh=function(a,b,d,e){var f,g,h;return f=p.extend({toolbox:{show:!0,feature:{mark:{show:!0},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!1,yAxis:[{type:"value"}]},d),f.xAxis=[{type:"category",data:p.pluck(b,"key")}],b=p.map(b,function(a){return a.values[0].v}),f.series=[{type:"bar",data:b}],g=c(a).get(0),h=j.init(g,i),h.setOption(f,!0),e?setInterval(function(){return e(function(a,b){return b?(b=p.map(b,function(a){return a.values[0].v}),f.series[0].data=b,h.setOption(f,!0)):void 0})},1e4):void 0},i={color:["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#008acd"}},legend:{itemGap:8},dataRange:{itemWidth:15,color:["#2ec7c9","#b6a2de"]},toolbox:{color:["#1e90ff","#1e90ff","#1e90ff","#1e90ff"],effectiveColor:"#ff4500",itemGap:8},tooltip:{backgroundColor:"rgba(50,50,50,0.5)",axisPointer:{type:"line",lineStyle:{color:"#008acd"},crossStyle:{color:"#008acd"},shadowStyle:{color:"rgba(200,200,200,0.2)"}}},dataZoom:{dataBackgroundColor:"#efefff",fillerColor:"rgba(182,162,222,0.2)",handleColor:"#008acd"},grid:{borderColor:"#eee"},categoryAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},polar:{axisLine:{lineStyle:{color:"#ddd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}},splitLine:{lineStyle:{color:"#ddd"}}},timeline:{lineStyle:{color:"#008acd"},controlStyle:{normal:{color:"#008acd"},emphasis:{color:"#008acd"}},symbol:"emptyCircle",symbolSize:3},bar:{itemStyle:{normal:{borderRadius:5},emphasis:{borderRadius:5}}},line:{smooth:!0,symbol:"emptyCircle",symbolSize:3},k:{itemStyle:{normal:{color:"#d87a80",color0:"#2ec7c9",lineStyle:{width:1,color:"#d87a80",color0:"#2ec7c9"}}}},scatter:{symbol:"circle",symbolSize:4},radar:{symbol:"emptyCircle",symbolSize:3},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#d87a80"}}},emphasis:{areaStyle:{color:"#fe994e"},label:{textStyle:{color:"rgb(100,0,0)"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#1e90ff"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#2ec7c9"],[.8,"#5ab1ef"],[1,"#d87a80"]],width:10}},axisTick:{splitNumber:10,length:15,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:22,lineStyle:{color:"auto"}},pointer:{width:5,color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}})}).call(this);
(function(){seajs.use(["jquery","underscore","async","user"],function(a,b,c,d){var e,f;return f=Backbone.View.extend({events:{"click .logIn":"logIn","click .logOut":"logOut"},initialize:function(){return this.listenTo(d,"status",this.changeStatus)},logIn:function(){return d.logIn()},logOut:function(){return d.logOut()},changeStatus:function(a){var b,c,d;return b=this.$el,c=b.find(".logIn"),d=b.find(".logOut"),"logged"!==a?(c.removeClass("hidden"),d.addClass("hidden")):(c.addClass("hidden"),d.removeClass("hidden"))}}),e=Backbone.View.extend({initialize:function(){return this.listenTo(d,"status",this.changeStatus)},changeStatus:function(){return this.$el.find(".name").text(d.get("name"))}}),new f({el:a(".menuContainer")}),new e({el:a(".headerContainer")}),b.delay(function(){return"development"===CONFIG.env?seajs.emit("loadComplete"):void 0},1e3)})}).call(this);
(function(){seajs.use(["jquery","underscore","Backbone","widget","debug","user","async"],function(a,b,c,d,e,f,g){return g.waterfall([function(a){return f.isLogedIn()?a(null,f.get("sets")):f.on("status",function(b){return b?a(null,f.get("sets")):a(new Error("user is not login"))})},function(b,c){return a.ajax({url:"/set/"+b[0],dataType:"json"}).success(function(a){return c(null,a)}).error(function(a){return c(a)})},function(c){return seajs.use("ChartView",function(d){var e;return e=a(".charListContainer"),b.each(c.configs,function(b){var c,f;return f=a("<div />"),f.addClass("chartView col-xs-"+b.width),f.appendTo(e),c=new d({el:f}),c.setOptions(b),c.show()})})}])})}).call(this);