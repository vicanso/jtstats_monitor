(function(){define("user",["jquery","underscore","async","Backbone"],function(a,b){var c,d,e,f,g,h,i;c=a("jquery"),i=a("underscore"),f=a("async"),d=a("Backbone"),g=function(){},i.extend(b,d.Events),e=d.Model.extend({defaults:{anonymous:!0},url:function(){return"/user?cache=false"},initialize:function(){return this.fetch()}}),h=new e,h.on("change:anonymous",function(a,c){var d;return d="logged",c&&(d="unlogged"),"logged"===d&&h.set("id","vicanso"),b.trigger("status",d)}),b.isLogedIn=function(){return!h.get("anonymous")},b.logOut=function(){return h.destroy({success:function(a,b){return h.set("name",""),h.set("id",""),i.each(b,function(a,b){return h.set(b,a)})},error:function(){return console.dir("error")}})},b.logIn=function(){var a,b,d;return d=c('<div class="maskContainer" />').appendTo("body"),b='<div class="logInDialog"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a href="javascript:;" class="glyphicon glyphicon-remove close"></a>登录</h3></div></div><div class="panel-body"><input type="text" class="form-control user" autofocus placeholder="用户名" /><input type="password" class="form-control password" autofocus placeholder="密码" /><div class="alert hidden"></div><div class="row"><div class="col-xs-6"><a href="javascript:;" class="btn btn-success register">注册</a></div><div class="col-xs-6"><a href="javascript:;" class="btn btn-primary logIn">登录</a></div></div></div></div>',a=c(b).appendTo("body"),a.on("click",".close, .logIn, .register",function(){var b,e,f,g,j,k,l;return e=c(this),e.hasClass("logIn")||e.hasClass("register")?(k=a.find("input.user"),(l=k.val().trim())?(g=a.find("input.password"),(f=g.val().trim())?(b=a.find(".alert"),b.removeClass("alert-warning hidden"),b.addClass("alert-info"),b.text("正在提交中，请稍候..."),j="logIn",e.hasClass("register")&&(j="register"),seajs.use("crypto",function(c){var e;return h.set("type",j),e=c.SHA1(f).toString(),"logIn"===j&&(e=c.SHA1(""+e+"_"+h.get("hash")).toString()),h.set("pwd",e),h.set("name",l),h.save({},{error:function(){return b.removeClass("alert-info").addClass("alert-warning"),b.text("register"===j?"注册失败！":"登录失败！")},success:function(b,c){return i.each(c,function(a,c){return b.set(c,a)}),a.remove(),d.remove()}})})):void g.focus()):void k.focus()):(a.remove(),d.remove())})},b.get=function(a){return h.get(a)}})}).call(this);
(function(){seajs.use(["jquery","underscore","async","user"],function(a,b,c,d){var e,f;return f=Backbone.View.extend({events:{"click .logIn":"logIn","click .logOut":"logOut"},initialize:function(){return this.listenTo(d,"status",this.changeStatus)},logIn:function(){return d.logIn()},logOut:function(){return d.logOut()},changeStatus:function(a){var b,c,d;return b=this.$el,c=b.find(".logIn"),d=b.find(".logOut"),"logged"!==a?(c.removeClass("hidden"),d.addClass("hidden")):(c.addClass("hidden"),d.removeClass("hidden"))}}),e=Backbone.View.extend({initialize:function(){return this.listenTo(d,"status",this.changeStatus)},changeStatus:function(){return this.$el.find(".name").text(d.get("name"))}}),new f({el:a(".menuContainer")}),new e({el:a(".headerContainer")}),b.delay(function(){return"development"===CONFIG.env?seajs.emit("loadComplete"):void 0},1e3)})}).call(this);
(function(){seajs.use(["jquery","underscore","Backbone","user","debug"],function(a,b,c,d,e){var f,g,h,i;return e=e("view:configs"),e("start run configsView"),g=c.Model.extend({defaults:{width:4}}),h=c.Collection.extend({model:g}),i=c.View.extend({events:{"click .config .viewWidth .btn":"changeViewWidth","click .save":"save"},initialize:function(){return this.listenTo(this.model,"add remove",this.render)},changeViewWidth:function(b){var c,d,e,f,g,h,i;return g=a(b.currentTarget),e=g.index()-1,c=g.closest(".config").parent(),f=this.model.at(c.index()),h=f.get("width"),i=[4,6,8,12],d=i[e],c.addClass("col-xs-"+d).removeClass("col-xs-"+h),f.set("width",d)},save:function(c){var e,f,g,h,i;return h=a(c.currentTarget),h.hasClass("saving")?void 0:(e=this.$el,i=e.find(".setName"),(g=i.val().trim())?d.get("anonymous")?void d.logIn():(f=b.map(this.model.toJSON(),function(a){return b.pick(a,["id","width"])}),h.text("保存中..."),a.ajax({url:"/set",type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify({name:g,configs:f})}).success(function(){return h.text("已成功保存")}).error(function(){return h.text("保存失败")})):void i.focus())},render:function(){var a,c,d,e;return a=this.$el,c=this.model.toJSON(),c.length?(e=b.template('<div class="col-xs-<%= width %>"><div class="config"><div class="name"><%= name %></div><div class="desc"><%= desc %></div><div class="btn-group viewWidth"><button class="btn btn-default disabled">显示区域</button><button class="btn btn-default" type="button" title="占显示区域1/3"><span class="glyphicon glyphicon-align-left"></span></button><button class="btn btn-default" type="button" title="占显示区域1/2"><span class="glyphicon glyphicon-align-center"></span></button><button class="btn btn-default" type="button" title="占显示区域2/3"><span class="glyphicon glyphicon-align-right"></span></button><button class="btn btn-default" type="button" title="占满显示区域"><span class="glyphicon glyphicon-align-justify"></span></button></div></div></div>'),d=[],b.each(c,function(a){return d.push(e(a))}),a.find(".panel-body .configs").html(d.join("")),a.removeClass("hidden")):void a.addClass("hidden")}}),new(f=c.View.extend({events:{"click .preview":"preview","click .chartViewContainer .close":"closePreview","click .toggle":"toggle"},initialize:function(){var a;return e("initialize"),a=this.$el,this.templateConfigList=new h,this.templateConfigView=new i({model:this.templateConfigList,el:a.find(".statsTemplateConfig")}),this},toggle:function(b){var c,d,e,f,g;return f=a(b.currentTarget),d=f.find(".glyphicon").toggleClass("glyphicon-plus glyphicon-minus").hasClass("glyphicon-plus"),g=f.closest("tr"),c=g.data("id"),d?(e=this.templateConfigList.find(function(a){return c===a.get("id")}),this.templateConfigList.remove(e)):this.templateConfigList.add({id:g.data("id"),name:g.find(".name").text(),desc:"暂无该统计的描述"}),this.closePreview()},closePreview:function(){return this.chartView&&this.chartView.remove(),this.$el.find(".chartViewContainer").addClass("hidden")},preview:function(b){var c,d,e,f,g;return this.chartView&&this.chartView.remove(),c=this.$el,g=a(b.currentTarget).closest("tr"),e=g.index(),d=c.find(".chartViewContainer"),f=d.removeClass("hidden").find(".panel-body").html("loading..."),seajs.use("ChartView",function(b){return function(c){var d,g;g=a('<div class="chartView" />'),f.empty().append(g),d=new c({el:g}),d.setOptions(JT_GLOBAL.configs[e]),d.show(),b.chartView=d}}(this))}}))({el:a(".statsConfigs")})})}).call(this);